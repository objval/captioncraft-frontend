Perfect, Nico. Since you want to go live using Hypay’s API and you already have access to the portal, I’ll gather the full list of credentials and configuration you need to set up for a production integration. I’ll also include where to find them and how to use them securely in your backend API setup.


# Hypay Live API Integration Setup Guide

Setting up a production integration with Hypay’s direct API involves obtaining several credentials from the Hypay portal and configuring secure authentication. Below are the required credentials and settings, where to find them, and best practices for using them in a live environment.

## Terminal (Masof) ID

**What it is:** The **Masof ID** is your terminal number – a unique identifier for your merchant account in Hypay/Yaad’s system. This ID tells Hypay which merchant/terminal is initiating the transaction. It’s a numeric code (for example, “1234567890”) that corresponds to your clearing terminal.

**Where to find it:** Log in to the Hypay portal and navigate to **Settings → Terminal Settings**. Here you will see your Terminal information. The **Terminal (Masof) number** is displayed in this section. It may also be labeled as “Terminal Number” or “Masof ID.” In the Hypay portal screenshot (as referenced in documentation), the Masof number is shown above the API Key field. Copy this number, as you will need to include it in every API request.

**Usage:** Every API call (or payment page request) must include the Masof ID to identify your account. In direct API calls (JSON/XML or form posts), this might be a field like `Masof` in the request payload. In the hosted payment URL (if you were using one), it appears as a query parameter `Masof=...`. Without the correct Masof ID, Hypay will not know which account is making the request, so ensure this is present and correct in all requests.

## User ID (Customer Number)

**What it is:** The **User ID** in Hypay is the customer/account identifier associated with your terminal. In some contexts this is referred to as the “Customer Number” on invoices. It’s often a numeric ID linked to your Hypay account (for example, a number like 203269535 as seen in integration examples). This ID can be required in API requests to further identify the merchant user, especially if your Hypay account has multiple users or configurations.

**Where to find it:** The User ID is typically provided when your account is set up. It may be visible in the Hypay portal under your account profile or in the **Terminal Settings** page along with the terminal info. In some cases, the User ID is the same as the username you use to log in, but often it’s a numeric code. One way to find it is on receipts or invoices generated by Hypay: the “customer number” printed there corresponds to your User ID. If it’s not obvious in the portal UI, you may need to contact Hypay support to confirm your exact User ID.

**Usage:** Many Hypay API calls include a `UserId` field along with the Masof. Ensure you include the correct User ID in each request if required. For example, when opening a payment page in English mode, Hypay’s docs note you must send a `UserId` (either a dummy `000000000` or your actual “L+Customer number” depending on context). In general, use your actual User ID for production API calls (unless instructed otherwise for specific use cases). This helps authenticate and route your transactions properly in Hypay’s system.

## API Key (Secret Key)

**What it is:** The **API Key** is a secret key associated with your Hypay terminal. This key is essentially a credential or token that Hypay uses to verify your identity and secure your transactions. The API Key is a unique alphanumeric string that “represents you in our system, helping us verify transactions and protect your deals”. In practice, this key is used to generate cryptographic signatures or to include as an authentication parameter in API calls.

**Where to find it:** In the Hypay portal, go to **Settings → Terminal Settings** (the same place as the Masof ID). You will find an **API Key** listed for your terminal (often labeled “API Key” or “Secret”). According to Hypay’s documentation, you can view your API key in that settings section. It’s typically shown as a long string of characters. If the portal hides it for security, there may be a “show” or “copy” button. **Note:** If no API key is visible, you might need to generate one. Some systems issue an API key when the terminal is created; others allow you to generate or reset it in the settings. The Hypay docs indicate that the API key is readily viewable in the Terminal Settings screen.

**Usage:** **This key should be kept secret** – do not share it or expose it in client-side code. It’s used for authenticating API requests, typically by creating a signature (see “Authentication Method” below). For instance, when Hypay expects a signed request, you will use this API Key to compute an HMAC signature that you send along with the request. Hypay’s system will use the API Key on file to verify that signature matches, thus confirming the request is from an authorized source. Always treat the API Key like a password.

## PassP (Password Parameter)

**What it is:** **PassP** stands for “Password Parameter.” This is an alternative credential – essentially a password – that can be used to authenticate your requests if you opt not to use signature-based auth. When using the hosted payment page, Hypay allows a mode where you include a visible password in the request (the PassP) instead of a cryptographic signature. This is simpler but less secure, as the password travels with the request. The PassP is a string that you define (e.g., “hyp” or “test123” in documentation examples) and set in the Hypay portal.

**Where to find or set it:** In the Hypay portal’s integration settings for your terminal, there is an **Authentication Method** setting. You can choose between using a signature or using a password for validating requests. To use the password method, select **PassP** as the authentication/validation method and enter a password of your choice in the provided field. For example, you might set the PassP to “MySecurePass123” (the Hypay docs show an example where they set it to “test123” for illustration). After saving this configuration, that password becomes your PassP.

**Usage:** If you choose PassP authentication, every API request (or payment page URL) must include a parameter for this password. Typically, the field is called `PassP` in the request. Hypay will check that the correct password is present. For instance, if your PassP is set to “test123,” you would add `PassP=test123` in your API call. In a CauseMatch integration guide (which uses YaadPay/Hypay), they mention copying the PassP password parameter into the integration settings so it’s included in every request. Keep in mind that **PassP is transmitted in plaintext** with the request, so anyone seeing the request could know your password. This is why PassP mode is generally **not recommended for production** use, except perhaps in server-to-server scenarios where the URL is never exposed publicly.

## Recommended Authentication Method: HMAC Signature (API Key) vs PassP

Hypay supports two ways to authenticate API interactions: using the **API Key to generate an HMAC signature**, or using the plain **PassP password**. For a **live production environment, the recommended method is to use the signature-based authentication** with your API Key, for better security.

* **Signature (HMAC) Method:** When enabled, instead of sending a raw password, you will send a calculated **signature** (often an HMAC hash) along with your requests. This signature is computed using your API Key (secret) and various request fields (typically concatenated in a specific order). Hypay’s system will independently calculate the expected signature with your API Key on their side and compare it. If it matches, the request is authenticated. The advantage is that the secret API Key itself is never sent over the wire – only the signature is. This greatly reduces the risk of credential compromise. The Hypay portal’s Terminal Settings page will show the API Key needed for this method, and you likely have an option there to enable “signature verification.” (In some configurations, you might see a checkbox like “Verify signature by payment page” which should be enabled if using HMAC.)

* **PassP (Password) Method:** This simpler method just checks a password string in each request. While easier to implement (no need to calculate a hash), it exposes your password in every API call or URL. Hypay documentation describes this as “Password authentication (PassP), allows you to access the page by a visible password”. Because the password is visible, it’s only suitable for scenarios where the entire request is server-to-server and secure. Even then, it’s less safe because if logs or intermediaries see the requests, the secret is leaked.

**Why use Signature in production:** It’s considered best practice to use the signature method in production to protect your transactions. Hypay’s API Key is specifically meant to **“verify transactions and protect your deals”**, which implies using it to sign requests. By using HMAC signatures, you ensure that no one can tamper with the request or replay it without knowing your secret. So, unless there’s a specific reason you cannot use HMAC, you should configure your Hypay terminal to use signature validation. (If your portal currently has “authentication method: PassP” selected, switch it to the signature option. This might involve generating a signature for each request using SHA-256 or a similar algorithm with your API Key – refer to Hypay’s API docs for the exact signature algorithm.)

**Important:** Both methods cannot be used simultaneously for the same request; you’ll choose one mode in the portal. For example, if you enable signature mode, the PassP might be ignored or not required (and vice versa). Ensure your portal settings match what your integration sends. In any case, **do not use test passwords like “hyp” or “yaad” in production** – set a strong, unique PassP if you must use that mode.

## Required Fields in Each API Request (Authentication)

When calling Hypay’s API in production, certain fields must be included in **every request** for proper authentication:

* **Masof (Terminal) ID:** Always include your terminal number as a field (e.g., `Masof`). This is required in both test and production calls to identify your merchant account. For example, an API JSON payload might contain `"Masof": "0012345678"`.

* **User ID:** In many cases you should include the User ID (customer account number) as well (`UserId` field). This might be especially necessary if you have multiple terminals or for certain operations. Hypay’s guidelines note that `UserId` appears on invoices and can be used in requests (for instance, to open an English-language payment page, you must send a specific UserId). Include your numeric User ID unless documentation for that specific API call says it’s optional.

* **Authentication Credential:** Depending on your chosen auth method, include **either**:

  * The `PassP` parameter with your password (if using PassP mode), **or**
  * The `signature` (if using signature/HMAC mode).

  In PassP mode, the field is typically `PassP` (or similarly named) and should exactly match the password you set in the portal. In signature mode, the field is often `signature` (plus possibly a flag like `Sign=True` if required). The signature is a hash you compute using the API Key and the request details. Hypay’s example integration query shows a `signature=908f05b9...` parameter alongside `Masof` and `UserId`【10†】, indicating how a signed request carries the signature value.

* **Additional fields as needed:** If Hypay uses any additional required fields for auth (for example, some APIs require a timestamp, nonce, or an identifier of the request), make sure to include those. Hypay’s basic integration doesn’t mention a timestamp or nonce in the examples we’ve seen, but double-check the official API docs for any such fields. Most likely, it’s just the three above (Terminal, User, and either PassP or Signature). The CauseMatch integration confirms that to process payments, they had to provide the Terminal number, API Key (for signature generation), and PassP if using that method.

In summary, a properly authenticated request will always carry your **Masof ID** and an **authentication proof** (password or signature). Missing any of these will result in authentication errors. Be sure to also follow the exact field names and formats that Hypay’s API expects (e.g., correct casing and data types – usually these are sent as strings of digits for IDs).

## Production Environment Considerations

Going live with Hypay involves a few environment-specific configurations and precautions:

* **Test vs Production Credentials:** Hypay uses separate terminals for testing and production. When you move to production, **update your integration to use the production credentials**. This means using your live Masof ID, User ID, and API Key/PassP for real transactions (they will be different from any sandbox/test values). The Hypay docs explicitly note that you need to replace any test terminal info with your production terminal info when going live. In practice, that might mean changing API endpoints (if the test uses a different URL) and swapping out the IDs and keys in your config to the live ones from the portal.

* **Production API Endpoint:** Ensure you are pointing to the correct production API URL or hosting page. Hypay’s test environment may be on a different domain or path (for example, a test endpoint might be on a sandbox subdomain or use a flag). The production endpoint for Hypay’s API (for direct server calls) should be given in their documentation. Double-check you’re using the live endpoint (for instance, `https://api.hyp.co.il/...` or a similar base, if provided by Hypay). The hosted payment page for production is usually at `pay.hyp.co.il` (as seen in the example URL) whereas some documentation references an `icom.yaad.net` domain for test pages. Use the appropriate one as instructed by Hypay for live transactions.

* **Account Activation & Merchant IDs:** Make sure your production terminal is **activated and approved**. In Israel, getting a production terminal usually requires having an internet processing agreement with a credit card acquirer. Hypay (which works with Yaad) will not open a live terminal for you unless you have provided valid merchant account details (e.g., an agreement with Visa/MasterCard provider). This is usually done during onboarding, but if you only had a test terminal initially, coordinate with Hypay to activate the live terminal. (Per YaadPay notes: *“Ideally, you should have an internet processing account with your credit card provider… If no valid payment method was provided, YaadPay will not take responsibility for opening a terminal.”*).

* **Card Types and Restrictions:** In production, the cards and payment methods you can accept depend on your agreements. For example, Yaad/Hypay notes that if you have an account with Visa CAL, that also covers Diners; if you have an account with Isracard, that covers American Express. Be aware of which card brands are enabled on your terminal. Attempting a card type not supported by your merchant account will result in errors. This isn’t a “credential” per se, but a configuration aspect of going live (you might need to ask Hypay to enable certain card types once you have the proper agreements).

* **No Dummy Data in Production:** It should go without saying, but use real customer data and real card numbers only in production. Remove any test flags or test card numbers that were used in sandbox mode. For instance, if Hypay’s test mode allowed a dummy card like “4580...1111” or required `tmp=1` in the request, those should not be used in live mode. Live mode will process actual charges, so test card numbers will be declined and test parameters may cause errors.

* **Monitoring and Error Handling:** Once in production, monitor your transactions closely at first. Use the Hypay portal to verify that transactions are appearing correctly in the **Deals/Transactions** section. The portal allows you to view deals, invoices, and standing orders in real time, so make sure everything from your API integration is reflected as expected. Any authentication errors or misconfigurations will likely show up as error responses from the API (e.g., “Incorrect credentials” errors). If you encounter these, double-check the Masof, UserId, and auth values you’re sending.

* **IP Whitelisting (if applicable):** Hypay’s documentation doesn’t explicitly mention needing to whitelist IPs, but some payment providers require it for API access. Check the portal’s API settings or with Hypay support to see if you must register your server’s IP address for live API calls. If yes, add your production server IPs to the allowed list in the Hypay portal before making live calls.

In summary, treat the production environment as locked down: use the live endpoints and credentials, and ensure all prerequisites (merchant account, enabled card types) are in place for a smooth go-live.

## Secure Storage and Management of Credentials (NestJS Best Practices)

Handling Hypay credentials in your backend code (for example, a NestJS application) should be done with great care. These values are highly sensitive (equivalent to passwords to your payment account). Here are guidelines for storing and using them securely:

* **Use Environment Variables:** Do not hard-code the Masof ID, User ID, API Key, or PassP in your code repository. Instead, store them in environment variables or a configuration file that is not committed to version control. For instance, you might have a `.env` file or use your server’s environment settings:

  ```env
  HYPAY_MASOF_ID=1234567890
  HYPAY_USER_ID=203269535
  HYPAY_API_KEY=abcdefghijklmnopqrstuvwxyz123456
  HYPAY_PASSP=mySecretPass (if using PassP)
  ```

  Then, use NestJS’s configuration service to load these. NestJS provides the `@nestjs/config` module which makes it easy to manage and inject these variables into your services.

* **Never commit secrets to git:** Make sure your `.env` or config files containing these credentials are **gitignored** and not uploaded to code repositories. This prevents accidental leakage of credentials. It’s a common security pitfall to accidentally push API keys to a public repo – avoid this at all costs.

* **Principle of least privilege:** Only use the credentials where necessary in your code. For example, if you write a HypayService in NestJS, that service alone should read the API key from the config. Don’t scatter the credentials across multiple files. This way, if you need to rotate a key, you update it in one place. Also, do not expose these values via any API endpoints or logs.

* **Secure configuration management:** NestJS’s dependency injection and config modules allow you to supply the credentials at runtime rather than hardcoding. In your code, you might do something like:

  ```ts
  @Injectable()
  export class HypayService {
    constructor(private config: ConfigService) {
      this.masof = config.get<string>('HYPAY_MASOF_ID');
      this.userId = config.get<string>('HYPAY_USER_ID');
      this.apiKey = config.get<string>('HYPAY_API_KEY');
      this.passP = config.get<string>('HYPAY_PASSP');
    }
    // ... use these in API calls or signature generation
  }
  ```

  This keeps the sensitive data out of your source code.

* **Consider Secret Managers:** For an extra layer of security, especially in a production environment, consider using a dedicated secrets management service (AWS Secrets Manager, HashiCorp Vault, Azure Key Vault, etc.). These services can store your Hypay API Key and other secrets and supply them to your application at runtime. This reduces the risk of someone extracting secrets from the server or env files. NestJS can be configured to fetch from such vaults (often via plugins or at deployment time).

* **Rotate keys if needed:** If you suspect a credential is compromised or as a regular security practice, rotate your API keys/passwords. Hypay may allow you to generate a new API Key in the portal. If so, update the .env and redeploy. Also, change the PassP in the portal and update it in your config if you think it’s leaked. Always remove old credentials from all systems and don’t leave them lingering in code or config history.

* **Limit exposure in logs:** When logging events in your NestJS app, be careful not to log the actual credentials or full request URLs that contain them. For example, if using PassP (which travels in a request), make sure to strip it out or mask it in any logs. The same goes for the signature – while HMAC signatures can’t be used to reverse-engineer the key, it’s still good practice not to log sensitive transaction details.

By following these practices, you ensure that your Hypay integration keys remain secure. Use NestJS’s robust configuration management to your advantage to keep secrets out of your codebase and only in memory at runtime. In short, **store Hypay credentials in environment variables, load them via NestJS ConfigService, and never commit or expose them publicly**. This will help protect your payment integration and customer data.

### References

* Hypay/YaadPay API Documentation – credentials and portal setup
* CauseMatch Hypay Integration Guide – locating API Key, Masof ID, and configuring PassP
* YaadPay/Hypay Guidelines – production readiness and account requirements
* NestJS Security Best Practices – secure config management and secret storage



OUR CREDENTIALS FOR THIS ARE: 

Terminal number : 4501961334

APIKEY  : 1a33779d57abe280e7d0e9e8f7b60f5c8488411e
Password ( PassP) : vxvxfvfx456

make sure like in 10000% the invoice module is integrated to the payments module otherwise im in jail